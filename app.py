import streamlit as st

# --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–¥–µ–∞–ª–∞ ---
H_IDEAL = 160.0  # —Å–º (–í—ã—Å–æ—Ç–∞)
D_IDEAL = 375.0  # —Å–º (–î–∞–ª—å–Ω–æ—Å—Ç—å)
W_IDEAL_HALF = 100.0 # —Å–º (–ü–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã, —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞)
W_IDEAL = W_IDEAL_HALF * 2.0 # —Å–º (–û–±—â–∞—è —à–∏—Ä–∏–Ω–∞)

# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ–¥–æ–±–∏—è
K_H = H_IDEAL / D_IDEAL  # K_H (–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π: H/D)
K_W = W_IDEAL / D_IDEAL  # K_W (–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π: W/D)

# –ü—Ä–µ–¥–µ–ª—ã
H_MAX = 360.0
D_MAX = 750.0
W_MAX = D_MAX * K_W # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞, –∫–æ—Ç–æ—Ä—É—é —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–∞ D_MAX


st.set_page_config(page_title="–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å —à–∏—Ä–∏–Ω–æ–π", layout="centered")

st.title("üìπ –†–∞—Å—á–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏: –í—ã—Å–æ—Ç–∞, –î–∞–ª—å–Ω–æ—Å—Ç—å –∏ –®–∏—Ä–∏–Ω–∞")
st.write(f"""
    –ò–¥–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: H={H_IDEAL}—Å–º, D={D_IDEAL}—Å–º. 
    –ù–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ {D_IDEAL}—Å–º –∫–∞–º–µ—Ä–∞ –≤–∏–¥–∏—Ç —à–∏—Ä–∏–Ω—É {W_IDEAL}—Å–º (100—Å–º –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ).
    *–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π K={K_H:.4f}, –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π K={K_W:.4f}.*
""")

# --- –õ–æ–≥–∏–∫–∞ Session State –¥–ª—è —Å–≤—è–∑–∏ –ø–æ–ª–∑—É–Ω–∫–æ–≤ ---
if 'height' not in st.session_state:
    st.session_state.height = H_IDEAL
if 'dist' not in st.session_state:
    st.session_state.dist = D_IDEAL

def update_height():
    """–ï—Å–ª–∏ –¥–≤–∏–≥–∞–µ–º –¥–∞–ª—å–Ω–æ—Å—Ç—å (D), –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É (H) –∏ –æ–±—Ä–µ–∑–∞–µ–º –µ–µ –ø–æ H_MAX."""
    # 1. –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é –≤—ã—Å–æ—Ç—É (H)
    new_height = round(st.session_state.dist * K_H, 1)
    # 2. –û–±—Ä–µ–∑–∞–µ–º H
    st.session_state.height = min(new_height, H_MAX)
    # 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∏—Ä–∏–Ω—É (W) (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª–∑—É–Ω–æ–∫, –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –º–µ—Ç—Ä–∏–∫—É)
    # –®–∏—Ä–∏–Ω–∞ W —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–µ—Ç—Ä–∏–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –ø–æ–ª–∑—É–Ω–∫–æ–≤.

def update_dist():
    """–ï—Å–ª–∏ –¥–≤–∏–≥–∞–µ–º –≤—ã—Å–æ—Ç—É (H), –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∞–ª—å–Ω–æ—Å—Ç—å (D) –∏ –æ–±—Ä–µ–∑–∞–µ–º –µ–µ –ø–æ D_MAX."""
    # 1. –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é –¥–∞–ª—å–Ω–æ—Å—Ç—å (D)
    if K_H == 0:
        new_dist = D_MAX
    else:
        new_dist = round(st.session_state.height / K_H, 1)
        
    # 2. –û–±—Ä–µ–∑–∞–µ–º D
    st.session_state.dist = min(new_dist, D_MAX)
    # 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∏—Ä–∏–Ω—É (W) (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª–∑—É–Ω–æ–∫)

# --- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ---
st.markdown("---")

# –ü–æ–ª–∑—É–Ω–æ–∫ –í—ã—Å–æ—Ç—ã. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –î–∞–ª—å–Ω–æ—Å—Ç—å.
h_val = st.slider(
    "1. –í—ã—Å–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç –ø–æ–ª–∞ (H, —Å–º):",
    min_value=50.0,
    max_value=H_MAX,
    key='height',
    on_change=update_dist,
    format="%.1f —Å–º"
)

# –ü–æ–ª–∑—É–Ω–æ–∫ –î–∞–ª—å–Ω–æ—Å—Ç–∏. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –í—ã—Å–æ—Ç—É.
d_val = st.slider(
    "2. –î–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç –¥–≤–µ—Ä–∏ (D, —Å–º):",
    min_value=100.0,
    max_value=D_MAX,
    key='dist',
    on_change=update_height,
    format="%.1f —Å–º"
)

# –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π —à–∏—Ä–∏–Ω—ã (W) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π –î–∞–ª—å–Ω–æ—Å—Ç–∏ (D)
W_current = round(st.session_state.dist * K_W, 1)
W_half_current = round(W_current / 2.0, 1)

st.markdown("---")

# --- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ ---
st.header("üìà –ò—Ç–æ–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–∑–æ—Ä–∞")

col1, col2, col3 = st.columns(3)

col1.metric("–í—ã—Å–æ—Ç–∞ (H)", f"{st.session_state.height} —Å–º")
col2.metric("–î–∞–ª—å–Ω–æ—Å—Ç—å (D)", f"{st.session_state.dist} —Å–º")
col3.metric("–®–∏—Ä–∏–Ω–∞ –æ–±–∑–æ—Ä–∞ (W)", f"{W_current} —Å–º")


st.markdown(f"""
    <p style='font-size: 0.8em; text-align: center;'>
    (–ö–∞–º–µ—Ä–∞ –≤–∏–¥–∏—Ç –ø–æ **{W_half_current} —Å–º** –≤–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –Ω–∞ –¥–∞–ª—å–Ω–æ—Å—Ç–∏ {st.session_state.dist} —Å–º)
    </p>
""", unsafe_allow_html=True)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
is_h_maxed = st.session_state.height == H_MAX
is_d_maxed = st.session_state.dist == D_MAX

st.markdown("---")

if is_h_maxed and is_d_maxed:
    st.error("üö® –í–Ω–∏–º–∞–Ω–∏–µ: –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã –ø—Ä–µ–¥–µ–ª—ã –ø–æ –æ–±–æ–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ K –Ω–∞—Ä—É—à–µ–Ω–æ.")
elif is_h_maxed:
    st.warning(f"‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø—Ä–µ–¥–µ–ª –≤—ã—Å–æ—Ç—ã ({H_MAX} —Å–º).")
elif is_d_maxed:
    st.warning(f"‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø—Ä–µ–¥–µ–ª –¥–∞–ª—å–Ω–æ—Å—Ç–∏ ({D_MAX} —Å–º).")
else:
    st.success("‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–æ—Ä–º–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ.")
